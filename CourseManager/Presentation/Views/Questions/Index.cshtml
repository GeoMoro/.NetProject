@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@model IEnumerable<Data.Domain.Entities.Question>

@{
    ViewData["Title"] = "Index";
}

<h2>Index</h2>
<!--
<p>
    <a asp-action="Create">Create New Question</a>
</p>
-->
@using (Html.BeginForm("Create", "Questions", new { uid = UserManager.GetUserId(User)}, FormMethod.Post, null, new { }))
{
    <button  class="btn btn-default" >Create New</button>
}

<table class="table">
    <thead>
    <tr>
        <!--<th>
            @Html.DisplayNameFor(model => model.UserId)
        </th> 
        <th>
            @Html.DisplayNameFor(model => model.CreatedDate)
        </th>-->
        <th>
            <center>
                @Html.DisplayNameFor(model => model.Topic)
            </center>
        </th>
        <th>
            <center>
                @Html.DisplayNameFor(model => model.Text)
            </center>
        </th>
            
        <th>
            <center>
                Answer
            </center>
        </th>
                
        <th>
        </th>
        <th>
            <center>
                Operations for Answer
            </center>
        </th>
        <th>
        </th>
            
        <th>
            <center>
                AnswerDate
            </center>
        </th>
        
        <th>
            <center>
                Operations for Question
            </center>
        </th>
    </tr>
    </thead>
    <tbody>
    @foreach (var item in Model) {
        <tr>
            <!--<td>
                @Html.DisplayFor(modelItem => item.UserId)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreatedDate)
            </td>-->
            <td>
                <center>
                @Html.DisplayFor(modelItem => item.Topic)
                </center>
            </td>
            <td>
                <center>
                    @Html.DisplayFor(modelItem => item.Text)
                </center>
            </td>
            <td>
                <center>
                    <br>
                    @foreach (var answer in item.Answers)
                    {
                        @answer.Text
                        <br />
                    }
                
                    <div class="form-group">
                        
                        <br>
                        @using (Html.BeginForm("CreateNewAnswer", "Answers", new { qid = item.Id, uid = UserManager.GetUserId(User)}, FormMethod.Post, null, new { }))
                        {
                            <input type="text" id="qtext" name="qtext">
                            <br>
                            <button class="Create New">Submit Answer</button>
                        }

                    </div>
                </center>
            </td>
            
            <td>
                <center>
                    <!-- Edit for Answer -->
                
                    <br>
                    @foreach (var answer in item.Answers)
                    {
                        string gui1 = answer.UserId.ToString();

                        if (User.IsInRole("Assistant") || User.IsInRole("Owner") || gui1 == UserManager.GetUserId(User))
                        {
                              <a asp-controller="Answers" asp-action="Edit" asp-route-id="@answer.Id">Edit</a>
                              <br>
                         }
                    }
                
                </center>
            </td>

            <td>
                <center>
                    <!-- Details for Answer -->
                    <br>
                    @foreach (var answer in item.Answers)
                    {
                        <a asp-controller="Answers" asp-action="Details" asp-route-id="@answer.Id">Details</a>
                        <br>
                    }
                </center>
            </td>
            
            <td>
                <center>
                    <!-- Delete for Answer -->
                    <br>
                    @foreach (var answer in item.Answers)
                    {
                        string gui2 = answer.UserId.ToString();

                        if (User.IsInRole("Assistant") || User.IsInRole("Owner") || gui2 == UserManager.GetUserId(User))
                        {
                            <a  class="btn btn-default" asp-controller="Answers" asp-action="Delete" asp-route-id="@answer.Id">Delete</a>
                            <br>
                        }
                    }
                </center>
            </td>

            <td>
                <center>
                    <br>
                    @foreach (var answer in item.Answers)
                    {
                        @answer.AnswerDate
                        <br />
                    }
                </center>
            </td>

            @{
                string gui3 = @item.UserId.ToString();
                if (User.IsInRole("Assistant") || User.IsInRole("Owner") || gui3 == UserManager.GetUserId(User))
                {
                    <td>
                        <center>
                            <a  class="btn btn-default" asp-action="Edit" asp-route-id="@item.Id">Edit</a>
                            <a  class="btn btn-default" asp-action="Details" asp-route-id="@item.Id">Details</a>
                            <a  class="btn btn-default" asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                        </center>
                    </td>
                }
            }
               
        </tr>
    }
    </tbody>
</table>

